C51 COMPILER V9.57.0.0   IIC                                                               01/07/2021 18:03:34 PAGE 1   


C51 COMPILER V9.57.0.0, COMPILATION OF MODULE IIC
OBJECT MODULE PLACED IN .\Objects\iic.obj
COMPILER INVOKED BY: D:\Keil_v5\C51\BIN\C51.EXE iic.c LARGE OPTIMIZE(8,SPEED) BROWSE INCDIR(.\DMP) DEBUG OBJECTEXTEND PR
                    -INT(.\Listings\iic.lst) TABS(2) OBJECT(.\Objects\iic.obj)

line level    source

   1          #include "iic.h"
   2          
   3          
   4          //*************************************************************************************************
   5          //I2C起始信号
   6          //*************************************************************************************************
   7          void I2C_Start()
   8          {
   9   1          SDA = 1;                    //拉高数据线
  10   1          SCL = 1;                    //拉高时钟线
  11   1          delay_us(5);                 //延时
  12   1          SDA = 0;                    //产生下降沿
  13   1          delay_us(5);                 //延时
  14   1          SCL = 0;                    //拉低时钟线
  15   1      }
  16          //*************************************************************************************************
  17          //I2C停止信号
  18          //*************************************************************************************************
  19          void I2C_Stop()
  20          {
  21   1          SDA = 0;                    //拉低数据线
  22   1          SCL = 1;                    //拉高时钟线
  23   1          delay_us(5);                 //延时
  24   1          SDA = 1;                    //产生上升沿
  25   1          delay_us(5);                 //延时
  26   1      }
  27          //**************************************************************************************************
  28          //I2C发送应答信号
  29          //入口参数:ack (0:ACK 1:NAK)
  30          //**************************************************************************************************
  31          void I2C_SendACK(bit ack)
  32          {
  33   1          SDA = ack;                  //写应答信号
  34   1          SCL = 1;                    //拉高时钟线
  35   1          delay_us(5);                 //延时
  36   1          SCL = 0;                    //拉低时钟线
  37   1          delay_us(5);                 //延时
  38   1      }
  39          //****************************************************************************************************
  40          //I2C接收应答信号
  41          //****************************************************************************************************
  42          bit I2C_RecvACK()
  43          {
  44   1          SCL = 1;                    //拉高时钟线
  45   1          delay_us(5);                 //延时
  46   1          CY = SDA;                   //读应答信号
  47   1          SCL = 0;                    //拉低时钟线
  48   1          delay_us(5);                 //延时
  49   1          return CY;
  50   1      }
  51          //*****************************************************************************************************
  52          //向I2C总线发送一个字节数据
  53          //*****************************************************************************************************
  54          void I2C_SendByte(u8 dat)
C51 COMPILER V9.57.0.0   IIC                                                               01/07/2021 18:03:34 PAGE 2   

  55          {
  56   1          u8 i;
  57   1          for (i=0; i<8; i++)         //8位计数器
  58   1          {
  59   2              dat <<= 1;              //移出数据的最高位
  60   2              SDA = CY;               //送数据口
  61   2              SCL = 1;                //拉高时钟线
  62   2              delay_us(5);             //延时
  63   2              SCL = 0;                //拉低时钟线
  64   2              delay_us(5);             //延时
  65   2          }
  66   1          I2C_RecvACK();
  67   1      }
  68          //*****************************************************************************************************
  69          //从I2C总线接收一个字节数据
  70          //******************************************************************************************************
  71          u8 I2C_RecvByte(bit n)
  72          {
  73   1          u8 i;
  74   1          u8 dat = 0;
  75   1          SDA = 1;                    //使能内部上拉,准备读取数据,
  76   1          for (i=0; i<8; i++)         //8位计数器
  77   1          {
  78   2              dat <<= 1;
  79   2              SCL = 1;                //拉高时钟线
  80   2              delay_us(5);             //延时
  81   2              dat |= SDA;             //读数据               
  82   2              SCL = 0;                //拉低时钟线
  83   2              delay_us(5);             //延时
  84   2          }
  85   1          I2C_SendACK(n);//发送nACK  or  ACK   
  86   1          return dat;
  87   1      }
  88          
  89          
  90          /*********************************END FILE*************************************/
  91          
  92          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    209    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----       4
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----       2
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
